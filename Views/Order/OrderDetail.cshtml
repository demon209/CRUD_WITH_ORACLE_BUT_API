@{
    ViewData["Title"] = "Chi ti·∫øt ƒë∆°n h√†ng";
}

<div class="mb-3">
    <div class="d-flex flex-column flex-md-row justify-content-between align-items-start align-items-md-center">
        <h2 class="mb-2 mb-md-0" id="order-title">üì¶ Chi ti·∫øt ƒë∆°n h√†ng</h2>
        <div>
            <a href="/HoaDon" class="btn btn-secondary">‚¨Ö Quay l·∫°i</a>
            <button class="btn btn-outline-primary ms-2" onclick="window.print()">üñ® In h√≥a ƒë∆°n</button>
        </div>
    </div>
</div>

<hr />

<div id="loading" class="text-center mt-5">
    <div class="spinner-border text-primary" role="status"></div>
    <div class="mt-2">ƒêang t·∫£i d·ªØ li·ªáu ƒë∆°n h√†ng...</div>
</div>

<div id="error-message" class="container mt-4"></div>

<div id="order-info" class="container mt-4 d-none"></div>
<div id="customer-info" class="container mt-4 d-none"></div>
<div id="pet-info" class="container mt-4 d-none"></div>
<div id="product-info" class="container mt-4 d-none"></div>

@section Scripts {
    <script>
        document.addEventListener("DOMContentLoaded", async function () {
            const urlParams = new URLSearchParams(window.location.search);
            const orderId = urlParams.get('id');
            const loadingEl = document.getElementById("loading");
            const errorEl = document.getElementById("error-message");

            if (!orderId) {
                loadingEl.style.display = "none";
                errorEl.innerHTML = `<div class="alert alert-danger">‚ùå Kh√¥ng t√¨m th·∫•y ID ƒë∆°n h√†ng tr√™n URL.</div>`;
                return;
            }

            try {
                const res = await fetch(`/api/orders/${orderId}/detail`);
                if (!res.ok) throw new Error("Kh√¥ng t√¨m th·∫•y ƒë∆°n h√†ng");

                const data = await res.json();

                if (!data.order || !data.customer) {
                    throw new Error("Thi·∫øu d·ªØ li·ªáu ƒë∆°n h√†ng ho·∫∑c kh√°ch h√†ng.");
                }

                document.getElementById("order-title").innerText = `üì¶ Chi ti·∫øt ƒë∆°n h√†ng c√≥ ID: ${data.order.orderId}`;

                // üßæ Order info
                document.getElementById("order-info").innerHTML = `
                    <div class="card shadow-sm rounded-3">
                        <div class="card-body">
                            <h3 class="card-title text-primary fw-bold mb-3">üìú Th√¥ng tin ƒë∆°n h√†ng</h3>
                            <ul class="list-unstyled fs-5">
                                <li><strong>Ng√†y t·∫°o h√≥a ƒë∆°n:</strong> ${new Date(data.order.orderDate).toLocaleDateString('vi-VN')}</li>
                                <li><strong>T·ªïng ti·ªÅn:</strong> ${data.order.totalAmount.toLocaleString()} VNƒê</li>
                            </ul>
                        </div>
                    </div>`;

                // üë§ Customer info
                document.getElementById("customer-info").innerHTML = `
                    <div class="card shadow-sm rounded-3">
                        <div class="card-body">
                            <h3 class="card-title text-primary fw-bold mb-3">üë§ Th√¥ng tin kh√°ch h√†ng</h3>
                            <ul class="list-unstyled fs-5">
                                <li><strong>ID:</strong> ${data.customer.customerId}</li>
                                <li><strong>T√™n:</strong> ${data.customer.firstName} ${data.customer.lastName}</li>
                                <li><strong>Email:</strong> ${data.customer.email}</li>
                                <li><strong>SƒêT:</strong> ${data.customer.phoneNumber}</li>
                                <li><strong>ƒê·ªãa ch·ªâ:</strong> ${data.customer.address}</li>
                            </ul>
                        </div>
                    </div>`;

                // üêæ Pet info
                const pet = data.pet;
                document.getElementById("pet-info").innerHTML = `
                    <div class="card shadow-sm rounded-3">
                        <div class="card-body">
                            <h3 class="card-title text-primary fw-bold mb-3">üêæ Th√¥ng tin th√∫ c∆∞ng</h3>
                            ${pet ? `
                            <ul class="list-unstyled fs-5">
                                <li><strong>·∫¢nh:</strong> ${pet.imageBase64 ? `<img src="${pet.imageBase64}" width="80" height="80" style="object-fit:cover; border-radius:8px;" />` : '<span class="text-muted">Kh√¥ng c√≥ ·∫£nh</span>'}</li>
                                <li><strong>ID:</strong> ${pet.petId}</li>
                                <li><strong>T√™n:</strong> ${pet.petName}</li>
                                <li><strong>Lo√†i:</strong> ${pet.petType}</li>
                                <li><strong>Gi·ªëng:</strong> ${pet.breed}</li>
                                <li><strong>Tu·ªïi:</strong> ${pet.age}</li>
                                <li><strong>Gi·ªõi t√≠nh:</strong> ${pet.gender}</li>
                                <li><strong>Gi√°:</strong> ${pet.price.toLocaleString()} VNƒê</li>
                            </ul>` : `<ul class="list-unstyled fs-5"><li class="text-muted">Kh√¥ng c√≥ th√∫ c∆∞ng n√†o li√™n quan ƒë·∫øn ƒë∆°n h√†ng n√†y.</li></ul>`}
                        </div>
                    </div>`;

                // üì¶ Product info
                const product = data.product;
                document.getElementById("product-info").innerHTML = `
                    <div class="card shadow-sm rounded-3">
                        <div class="card-body">
                            <h3 class="card-title text-primary fw-bold mb-3">üì¶ Th√¥ng tin s·∫£n ph·∫©m</h3>
                            ${product ? `
                            <ul class="list-unstyled fs-5">
                                <li><strong>ID:</strong> ${product.productId}</li>
                                <li><strong>T√™n:</strong> ${product.productName}</li>
                                <li><strong>Lo·∫°i:</strong> ${product.productCategory}</li>
                                <li><strong>Gi√°:</strong> ${product.productPrice.toLocaleString()} VNƒê</li>
                                <li><strong>S·ªë l∆∞·ª£ng:</strong> ${data.order.productQuantity}</li>
                                <li><strong>T·ªïng ti·ªÅn s·∫£n ph·∫©m:</strong> ${(product.productPrice * data.order.productQuantity).toLocaleString()} VNƒê</li>
                            </ul>` : `<ul class="list-unstyled fs-5"><li class="text-muted">Kh√¥ng c√≥ s·∫£n ph·∫©m n√†o li√™n quan ƒë·∫øn ƒë∆°n h√†ng n√†y.</li></ul>`}
                        </div>
                    </div>`;

                // Hi·ªÉn th·ªã n·ªôi dung
                loadingEl.style.display = "none";
                document.getElementById("order-info").classList.remove("d-none");
                document.getElementById("customer-info").classList.remove("d-none");
                document.getElementById("pet-info").classList.remove("d-none");
                document.getElementById("product-info").classList.remove("d-none");

            } catch (error) {
                console.error(error);
                loadingEl.style.display = "none";
                errorEl.innerHTML = `<div class="alert alert-danger">‚ùå ${error.message}</div>`;
            }
        });
    </script>
}
